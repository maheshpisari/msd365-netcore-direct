<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamics 365 to Netcore Integration (Single File)</title>
    <style>
        /* General Styling (Same as before) */
        body{font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;line-height:1.6;margin:0;padding:0;background-color:#f4f7f9;color:#333}
        .container{max-width:900px;margin:30px auto;padding:25px;background-color:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
        h1,h2,h3{color:#2c3e50;border-bottom:2px solid #e0e0e0;padding-bottom:10px;margin-bottom:20px}
        h1{font-size:2em}
        h2{font-size:1.5em;margin-top:30px}
        h3{font-size:1.2em;margin-top:25px;border-bottom-style:dashed;border-bottom-width:1px}
        p{margin-bottom:15px}
        code{font-family:"Consolas","Monaco","Courier New",monospace;background-color:#eef1f3;padding:2px 6px;border-radius:4px;font-size:.9em;color:#c7254e}
        .important-note{background-color:#fffbe6;border:1px solid #ffe58f;padding:15px;border-radius:4px;margin:15px 0}
        .important-note strong{color:#d46b08}
        .important-note ul{margin-top:10px;margin-bottom:5px}
        .important-note li{margin-bottom:5px}
        .code-comment{color:#888} /* Style for comments within code blocks */

        /* Tab Styling (Same as before) */
        .tabs{margin-bottom:0;border-bottom:1px solid #d4dadf;padding-bottom:-1px}
        .tab-button{padding:10px 20px;cursor:pointer;border:1px solid transparent;border-bottom:none;background-color:#f4f7f9;margin-right:5px;border-radius:5px 5px 0 0;font-size:1em;position:relative;bottom:-1px;transition:background-color .3s ease,border-color .3s ease}
        .tab-button:hover{background-color:#e9edf1}
        .tab-button.active{background-color:#fff;border-color:#d4dadf;border-bottom:1px solid #fff;font-weight:700;color:#3498db}

        /* Tab Content Area Styling (Same as before) */
        .tab-content-wrapper{padding:20px;border:1px solid #d4dadf;border-top:none;background-color:#fff;border-radius:0 0 8px 8px;min-height:200px}
        .tab-pane{display:none}
        .tab-pane.active{display:block}

        /* Code Block Styling (Same as before) */
        pre{background-color:#2d2d2d;color:#ccc;padding:20px;border-radius:6px;overflow-x:auto;font-family:"Consolas","Monaco","Courier New",monospace;font-size:.9em;line-height:1.5;margin-top:15px;margin-bottom:15px}
        pre code{background-color:transparent;padding:0;color:inherit;font-size:inherit;border-radius:0}
        .tab-pane p,.dynamics-section p{margin-top:15px;margin-bottom:10px;font-style:italic;color:#555}
        .dynamics-section p{font-style:normal} /* Override italic */
    </style>
</head>
<body>

    <div class="container">
        <h1>Integrating Microsoft Dynamics 365 with Netcore</h1>
        <p>
            This document outlines how to send contact data from Microsoft Dynamics 365 to Netcore's Smartech API. The process involves retrieving data from Dynamics and then making a POST request to the Netcore API.
        </p>
        <p>
            <strong>Netcore API Endpoint Structure:</strong><br>
            <code>https://api.netcoresmartech.com/apiv2?type=contact&activity=add&apikey=YOUR_API_KEY&listid=YOUR_LIST_ID</code>
        </p>
         <p>
            <strong>Netcore Request Body Format:</strong><br>
            <code>data={"EMAIL":"...","MOBILE":"...","FIRST_NAME":"...","LAST_NAME":"..."}</code> (Value must be URL-encoded)
        </p>

        <div class="dynamics-section">
            <h2>Dynamics 365 Implementation Approaches</h2>
            <p>To initiate the call to Netcore, you first need logic within Dynamics 365 to trigger on an event (like Contact create/update), retrieve data, and make the API call.</p>
            <ul>
                <li><strong>Power Automate (Flow):</strong> [Recommended for Cloud] Low-code approach using Dataverse connector and HTTP action.</li>
                <li><strong>C# Plugin / Custom Workflow Activity:</strong> Custom code for maximum flexibility, requires development and deployment.</li>
            </ul>
            <h3>Conceptual C# Plugin Example</h3>
            <p>See the previous C# Plugin example for retrieving data *within* Dynamics and calling Netcore. Remember the disclaimers regarding placeholders, security, and testing.</p>
            <h3>Power Automate (Flow) Outline</h3>
             <p>Refer to the previous outline for setting up a Flow using the Dataverse trigger and HTTP action.</p>
        </div>

        <h2>Netcore API Call Examples (with Conceptual Dynamics Data Retrieval)</h2>
        <p>
             The following examples show how to call the Netcore API in various languages. They now also include **conceptual code** for fetching data from Dynamics 365 using its Web API (OData) first.
        </p>
        <div class="important-note">
             <strong>IMPORTANT:</strong> The Dynamics 365 data retrieval snippets below are **conceptual examples only**.
             <ul>
                <li>They **omit essential OAuth authentication headers**. You MUST implement proper authentication.</li>
                <li>Replace ALL placeholders (Dynamics URL, entity names, field names, record IDs) with your actual values.</li>
                <li>Implement robust error handling.</li>
             </ul>
        </div>

        <div class="tabs">
            <button class="tab-button active" data-target="#python-content">Python</button>
            <button class="tab-button" data-target="#java-content">Java</button>
            <button class="tab-button" data-target="#javascript-content">JavaScript (Node.js)</button>
            <button class="tab-button" data-target="#csharp-content">C# (Web API Client)</button>
            <button class="tab-button" data-target="#php-content">PHP</button>
        </div>

        <div class="tab-content-wrapper">

            <div id="python-content" class="tab-pane active">
                <pre><code class="language-python">
import requests
import json
import urllib.parse # Not used here, but often useful for query params

# --- Netcore Configuration ---
NETCORE_API_KEY = 'YOUR_NETCORE_API_KEY' # <<< REPLACE
NETCORE_LIST_ID = 'YOUR_NETCORE_LIST_ID' # <<< REPLACE
NETCORE_BASE_URL = 'https://api.netcoresmartech.com/apiv2'

# --- Dynamics 365 Configuration (Conceptual) ---
DYNAMICS_API_ENDPOINT = "https://yourorg.api.crm[X].dynamics.com/api/data/v9.2/" # <<< REPLACE
ENTITY_PLURAL_NAME = "contacts" # Plural for OData query
RECORD_ID = "YOUR_DYNAMICS_RECORD_ID_GUID" # <<< REPLACE (GUID of the record to fetch)
# Use ACTUAL schema names from your Dynamics instance
FIELDS_TO_SELECT = "$select=firstname,lastname,emailaddress1,mobilephone" # <<< REPLACE/VERIFY

# Initialize dictionary to hold data for Netcore
contact_data_for_netcore = {}

# --- Conceptual Dynamics 365 Data Retrieval ---
print("--- Attempting Conceptual Dynamics Data Retrieval ---")
try:
    dynamics_fetch_url = f"{DYNAMICS_API_ENDPOINT}{ENTITY_PLURAL_NAME}({RECORD_ID})?{FIELDS_TO_SELECT}"
    print(f"Conceptual Dynamics Fetch URL: {dynamics_fetch_url}")

    # !!! CRITICAL: AUTHENTICATION IS MISSING HERE !!!
    # Real code requires an 'Authorization: Bearer <ACCESS_TOKEN>' header.
    dynamics_headers = {
        'Accept': 'application/json',
        'OData-MaxVersion': '4.0',
        'OData-Version': '4.0',
        'Prefer': 'odata.include-annotations="*"', # Useful for getting formatted values
        # 'Authorization': 'Bearer YOUR_ACCESS_TOKEN' # <<< REQUIRED BUT OMITTED
    }

    # --- SIMULATING API Call Success ---
    # In real code:
    # response = requests.get(dynamics_fetch_url, headers=dynamics_headers, timeout=30)
    # response.raise_for_status() # Check for HTTP errors
    # dynamics_data = response.json()
    # print("--- Successfully fetched Dynamics Data (Simulated) ---")

    # Using simulated data for demonstration:
    dynamics_data_simulated = {
         "@odata.context": "...",
         "firstname": "Mike (Read)",
         "lastname": "Py-Dynamics",
         "emailaddress1": "mike.read.py@example.com",
         "mobilephone": "5551112222",
         "contactid": RECORD_ID
    }
    dynamics_data = dynamics_data_simulated # Use simulated data
    print(f"Simulated Dynamics Response: {json.dumps(dynamics_data, indent=2)}")

    # --- Map Dynamics data to Netcore structure ---
    contact_data_for_netcore = {
        "EMAIL": dynamics_data.get("emailaddress1"),
        "MOBILE": dynamics_data.get("mobilephone"),
        "FIRST_NAME": dynamics_data.get("firstname"),
        "LAST_NAME": dynamics_data.get("lastname")
        # Map other fields as needed
    }
    # Optional: Remove keys with None values
    contact_data_for_netcore = {k: v for k, v in contact_data_for_netcore.items() if v is not None}
    print(f"--- Mapped data for Netcore: {contact_data_for_netcore} ---")

except Exception as e:
     print(f"ERROR during conceptual Dynamics retrieval/mapping: {e}")
     # Implement proper error handling (e.g., exit, log, skip)

# --- Proceed only if email is present ---
if not contact_data_for_netcore.get("EMAIL"):
    print("ERROR: Cannot proceed without EMAIL retrieved from Dynamics.")
else:
    print("\n--- Preparing Netcore API Call ---")
    # --- Prepare Netcore Request ---
    netcore_url = f"{NETCORE_BASE_URL}?type=contact&amp;activity=add&amp;apikey={NETCORE_API_KEY}&amp;listid={NETCORE_LIST_ID}"
    netcore_data_json = json.dumps(contact_data_for_netcore)
    netcore_payload = {'data': netcore_data_json}
    netcore_headers = {'Content-Type': 'application/x-www-form-urlencoded'}

    print(f"Netcore URL: {netcore_url}")
    print(f"Netcore Payload (url-encoded form data): data={urllib.parse.quote(netcore_data_json)}")

    # --- Send Request To Netcore ---
    try:
        print("--- Sending Request to Netcore ---")
        response = requests.post(netcore_url, data=netcore_payload, headers=netcore_headers, timeout=30)
        response.raise_for_status()

        print(f"Netcore Status Code: {response.status_code}")
        print("Netcore Response Body:")
        try:
            print(json.dumps(response.json(), indent=2))
        except json.JSONDecodeError:
            print(response.text) # Print as text if not JSON

    except requests.exceptions.RequestException as e:
        print(f"ERROR sending request to Netcore: {e}")
        if e.response is not None:
             print(f"Netcore Response Status: {e.response.status_code}")
             print(f"Netcore Response Body: {e.response.text}")

                </code></pre>
                <p>
                    This Python script now includes a **conceptual** block to fetch data from Dynamics 365 using its Web API (via `requests`) before preparing the Netcore request. **Crucially, authentication for Dynamics is omitted.** It simulates the response and maps the fields to the structure needed for Netcore. Replace ALL placeholders and implement real authentication and error handling. Note HTML escaping (&amp;amp;).
                </p>
            </div>

            <div id="java-content" class="tab-pane">
                <pre><code class="language-java">
import java.net.URI;
import java.net.URLEncoder;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.nio.charset.StandardCharsets;
import java.time.Duration;
// Needs a JSON processing library like Jackson or Gson for robust parsing
// Example uses manual string parsing for simplicity - NOT recommended for production
// Add dependencies: e.g., implementation 'com.fasterxml.jackson.core:jackson-databind:2.1x.x'

public class NetcoreIntegrationWithDynamicsRead {

    // --- Netcore Configuration ---
    private static final String NETCORE_API_KEY = "YOUR_NETCORE_API_KEY"; // <<< REPLACE
    private static final String NETCORE_LIST_ID = "YOUR_NETCORE_LIST_ID"; // <<< REPLACE
    private static final String NETCORE_BASE_URL = "https://api.netcoresmartech.com/apiv2";

    // --- Dynamics 365 Configuration (Conceptual) ---
    private static final String DYNAMICS_API_ENDPOINT = "https://yourorg.api.crm[X].dynamics.com/api/data/v9.2/"; // <<< REPLACE
    private static final String ENTITY_PLURAL_NAME = "contacts";
    private static final String RECORD_ID = "YOUR_DYNAMICS_RECORD_ID_GUID"; // <<< REPLACE
    private static final String FIELDS_TO_SELECT = "?$select=firstname,lastname,emailaddress1,mobilephone"; // <<< REPLACE/VERIFY

    private static final HttpClient httpClient = HttpClient.newBuilder()
            .version(HttpClient.Version.HTTP_1_1)
            .connectTimeout(Duration.ofSeconds(20))
            .build();

    public static void main(String[] args) {
        String netcoreJsonPayload = null;

        // --- Conceptual Dynamics 365 Data Retrieval ---
        System.out.println("--- Attempting Conceptual Dynamics Data Retrieval ---");
        try {
            String dynamicsFetchUrl = DYNAMICS_API_ENDPOINT + ENTITY_PLURAL_NAME + "(" + RECORD_ID + ")" + FIELDS_TO_SELECT;
            System.out.println("Conceptual Dynamics Fetch URL: " + dynamicsFetchUrl);

            // !!! CRITICAL: AUTHENTICATION IS MISSING HERE !!!
            // Real code requires an 'Authorization: Bearer <ACCESS_TOKEN>' header.
            HttpRequest dynamicsRequest = HttpRequest.newBuilder()
                    .uri(URI.create(dynamicsFetchUrl))
                    .header("Accept", "application/json")
                    .header("OData-MaxVersion", "4.0")
                    .header("OData-Version", "4.0")
                    // .header("Authorization", "Bearer YOUR_ACCESS_TOKEN") // <<< REQUIRED BUT OMITTED
                    .GET()
                    .timeout(Duration.ofSeconds(30))
                    .build();

            // --- SIMULATING API Call Success & Parsing ---
            // In real code:
            // HttpResponse<String> dynamicsResponse = httpClient.send(dynamicsRequest, HttpResponse.BodyHandlers.ofString());
            // if (dynamicsResponse.statusCode() >= 200 && dynamicsResponse.statusCode() < 300) {
            //    String responseBody = dynamicsResponse.body();
            //    System.out.println("--- Successfully fetched Dynamics Data (Simulated) ---");
            //    System.out.println("Dynamics Response Body: " + responseBody);
            //    // Use Jackson/Gson to parse responseBody into a Map or Object
            //    // ObjectMapper mapper = new ObjectMapper();
            //    // Map<String, Object> dynamicsData = mapper.readValue(responseBody, Map.class);
            // } else {
            //    throw new RuntimeException("Dynamics API call failed: " + dynamicsResponse.statusCode() + " Body: " + dynamicsResponse.body());
            //}

            // Using simulated data:
             String simulatedResponseBody = """
             {
                 "@odata.context": "...",
                 "firstname": "Mike (Read)",
                 "lastname": "Java-Dynamics",
                 "emailaddress1": "mike.read.java@example.com",
                 "mobilephone": "5553334444",
                 "contactid": "%s"
             }
             """.formatted(RECORD_ID); // Use simulated data
             System.out.println("Simulated Dynamics Response: " + simulatedResponseBody);

            // --- Map Dynamics data (Conceptual Manual Parsing - Use JSON lib in reality!) ---
            String email = extractJsonValue(simulatedResponseBody, "emailaddress1");
            String mobile = extractJsonValue(simulatedResponseBody, "mobilephone");
            String firstName = extractJsonValue(simulatedResponseBody, "firstname");
            String lastName = extractJsonValue(simulatedResponseBody, "lastname");

            if (email == null || email.isBlank()) {
                 throw new RuntimeException("Email not found in Dynamics data.");
            }

            // Construct JSON payload string for Netcore
            netcoreJsonPayload = String.format("""
                    {"EMAIL":"%s","MOBILE":"%s","FIRST_NAME":"%s","LAST_NAME":"%s"}""",
                    email, mobile != null ? mobile : "", firstName != null ? firstName : "", lastName != null ? lastName : "");

            System.out.println("--- Mapped data for Netcore (JSON String): " + netcoreJsonPayload + " ---");

        } catch (Exception e) {
            System.err.println("ERROR during conceptual Dynamics retrieval/mapping: " + e.getMessage());
            e.printStackTrace();
            // Handle error
        }

        // --- Proceed only if payload was created ---
        if (netcoreJsonPayload == null) {
             System.err.println("ERROR: Cannot proceed. Failed to prepare Netcore payload.");
        } else {
            System.out.println("\n--- Preparing and Sending Netcore API Call ---");
            try {
                // --- Prepare Netcore Request ---
                String netcoreUrl = String.format("%s?type=contact&amp;activity=add&amp;apikey=%s&amp;listid=%s",
                        NETCORE_BASE_URL, NETCORE_API_KEY, NETCORE_LIST_ID);

                String urlEncodedNetcoreData = URLEncoder.encode(netcoreJsonPayload, StandardCharsets.UTF_8);
                String netcoreRequestBody = "data=" + urlEncodedNetcoreData;
                System.out.println("Netcore URL: " + netcoreUrl);
                System.out.println("Netcore Request Body (form-urlencoded): " + netcoreRequestBody);


                HttpRequest netcoreRequest = HttpRequest.newBuilder()
                        .uri(URI.create(netcoreUrl))
                        .header("Content-Type", "application/x-www-form-urlencoded")
                        .POST(HttpRequest.BodyPublishers.ofString(netcoreRequestBody))
                        .timeout(Duration.ofSeconds(30))
                        .build();

                // --- Send Request To Netcore ---
                System.out.println("--- Sending Request to Netcore ---");
                HttpResponse<String> netcoreResponse = httpClient.send(netcoreRequest, HttpResponse.BodyHandlers.ofString());

                System.out.println("Netcore Status Code: " + netcoreResponse.statusCode());
                System.out.println("Netcore Response Body: " + netcoreResponse.body());
                if (netcoreResponse.statusCode() < 200 || netcoreResponse.statusCode() >= 300) {
                     System.err.println("Netcore request failed!");
                }

            } catch (Exception e) {
                System.err.println("ERROR sending request to Netcore: " + e.getMessage());
                e.printStackTrace();
            }
        }
    }

     // Basic helper for conceptual parsing - DO NOT USE IN PRODUCTION (use a JSON library)
     private static String extractJsonValue(String json, String key) {
         String searchKey = "\"" + key + "\":";
         int keyIndex = json.indexOf(searchKey);
         if (keyIndex == -1) return null;
         int valueStartIndex = keyIndex + searchKey.length();
         // Find start of value (skip whitespace, check for quote)
         while (valueStartIndex < json.length() && Character.isWhitespace(json.charAt(valueStartIndex))) { valueStartIndex++; }
         if (valueStartIndex >= json.length()) return null;
         char startChar = json.charAt(valueStartIndex);
         if (startChar == '"') { // String value
             valueStartIndex++; // Move past quote
             int valueEndIndex = json.indexOf('"', valueStartIndex);
             if (valueEndIndex == -1) return null; // Malformed
             return json.substring(valueStartIndex, valueEndIndex);
         } else if (startChar == 'n' && json.substring(valueStartIndex, valueStartIndex + 4).equals("null")) { // null value
             return null;
         } else { // Assume number or boolean (not handled robustly)
             int valueEndIndex = valueStartIndex;
             while (valueEndIndex < json.length() && json.charAt(valueEndIndex) != ',' && json.charAt(valueEndIndex) != '}') {
                 valueEndIndex++;
             }
             return json.substring(valueStartIndex, valueEndIndex).trim();
         }
     }
}
                </code></pre>
                <p>
                    This Java example includes a **conceptual** block using `java.net.http.HttpClient` to fetch Dynamics data. **Authentication is omitted.** It simulates the response and uses basic string manipulation (replace with a real JSON library like Jackson/Gson in production) to map fields before preparing the Netcore request. Replace placeholders, implement authentication/error handling. Note HTML escaping (&amp;lt;, &amp;gt;, &amp;amp;).
                </p>
            </div>

            <div id="javascript-content" class="tab-pane">
                <pre><code class="language-javascript">
// This example uses Node.js with node-fetch (npm install node-fetch)
// For built-in 'https', the structure is more complex.
// import fetch from 'node-fetch'; // Use this syntax for ESM modules
const fetch = require('node-fetch'); // Use this syntax for CommonJS
const { URLSearchParams } = require('url'); // For Netcore payload

// --- Netcore Configuration ---
const NETCORE_API_KEY = 'YOUR_NETCORE_API_KEY'; // <<< REPLACE
const NETCORE_LIST_ID = 'YOUR_NETCORE_LIST_ID'; // <<< REPLACE
const NETCORE_BASE_URL = 'https://api.netcoresmartech.com/apiv2';

// --- Dynamics 365 Configuration (Conceptual) ---
const DYNAMICS_API_ENDPOINT = "https://yourorg.api.crm[X].dynamics.com/api/data/v9.2/"; // <<< REPLACE
const ENTITY_PLURAL_NAME = "contacts";
const RECORD_ID = "YOUR_DYNAMICS_RECORD_ID_GUID"; // <<< REPLACE
const FIELDS_TO_SELECT = "?$select=firstname,lastname,emailaddress1,mobilephone"; // <<< REPLACE/VERIFY

// --- Main async function to orchestrate ---
async function syncContact() {
    let contactDataForNetcore = null;

    // --- Conceptual Dynamics 365 Data Retrieval ---
    console.log("--- Attempting Conceptual Dynamics Data Retrieval ---");
    try {
        const dynamicsFetchUrl = `<span class="math-inline">\{DYNAMICS\_API\_ENDPOINT\}</span>{ENTITY_PLURAL_NAME}(<span class="math-inline">\{RECORD\_ID\}\)</span>{FIELDS_TO_SELECT}`;
        console.log(`Conceptual Dynamics Fetch URL: ${dynamicsFetchUrl}`);

        // !!! CRITICAL: AUTHENTICATION IS MISSING HERE !!!
        // Real code requires an 'Authorization: Bearer <ACCESS_TOKEN>' header.
        const dynamicsHeaders = {
            'Accept': 'application/json',
            'OData-MaxVersion': '4.0',
            'OData-Version': '4.0',
            'Prefer': 'odata.include-annotations="*"',
            // 'Authorization': 'Bearer YOUR_ACCESS_TOKEN' // <<< REQUIRED BUT OMITTED
        };

        // --- SIMULATING API Call Success ---
        // In real code:
        // const response = await fetch(dynamicsFetchUrl, { method: 'GET', headers: dynamicsHeaders });
        // if (!response.ok) {
        //     throw new Error(`Dynamics API Error: ${response.status} ${response.statusText} - ${await response.text()}`);
        // }
        // const dynamicsData = await response.json();
        // console.log("--- Successfully fetched Dynamics Data (Simulated) ---");

        // Using simulated data:
         const dynamicsDataSimulated = {
             "@odata.context": "...",
             "firstname": "Mike (Read)",
             "lastname": "JS-Dynamics",
             "emailaddress1": "mike.read.js@example.com",
             "mobilephone": "5555556666",
             "contactid": RECORD_ID
        };
        const dynamicsData = dynamicsDataSimulated; // Use simulated data
        console.log(`Simulated Dynamics Response: ${JSON.stringify(dynamicsData, null, 2)}`);


        // --- Map Dynamics data to Netcore structure ---
        contactDataForNetcore = {
            EMAIL: dynamicsData?.emailaddress1, // Optional chaining for safety
            MOBILE: dynamicsData?.mobilephone,
            FIRST_NAME: dynamicsData?.firstname,
            LAST_NAME: dynamicsData?.lastname
            // Map other fields
        };
        // Optional: Filter out undefined/null values
        contactDataForNetcore = Object.entries(contactDataForNetcore)
            .filter(([_, v]) => v != null)
            .reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {});

        console.log(`--- Mapped data for Netcore: ${JSON.stringify(contactDataForNetcore)} ---`);

    } catch (error) {
        console.error(`ERROR during conceptual Dynamics retrieval/mapping: ${error.message}`);
        // Handle error appropriately
    }


    // --- Proceed only if email is present ---
     if (!contactDataForNetcore?.EMAIL) {
         console.error("ERROR: Cannot proceed without EMAIL retrieved from Dynamics.");
         return; // Exit function
     }

    console.log("\n--- Preparing and Sending Netcore API Call ---");
    try {
        // --- Prepare Netcore Request ---
        const netcoreUrl = `<span class="math-inline">\{NETCORE\_BASE\_URL\}?type\=contact&amp;activity\=add&amp;apikey\=</span>{NETCORE_API_KEY}&amp;listid=${NETCORE_LIST_ID}`;
        const netcoreDataJson = JSON.stringify(contactDataForNetcore);

        const netcoreBody = new URLSearchParams(); // Handles form-urlencoded
        netcoreBody.append('data', netcoreDataJson);

        const netcoreHeaders = {
            // 'Content-Type' is often set automatically by fetch with URLSearchParams
            // 'Content-Type': 'application/x-www-form-urlencoded'
        };
        console.log(`Netcore URL: ${netcoreUrl}`);
        console.log(`Netcore Payload (URLSearchParams): data=${encodeURIComponent(netcoreDataJson)}`);


        // --- Send Request To Netcore ---
        console.log("--- Sending Request to Netcore ---");
        const netcoreResponse = await fetch(netcoreUrl, {
            method: 'POST',
            headers: netcoreHeaders,
            body: netcoreBody
        });

        const responseText = await netcoreResponse.text(); // Get text first
        console.log(`Netcore Status Code: ${netcoreResponse.status} ${netcoreResponse.statusText}`);
        console.log("Netcore Response Body:");
        try {
             // Try to parse as JSON for pretty printing
             console.log(JSON.stringify(JSON.parse(responseText), null, 2));
        } catch(e) {
             console.log(responseText); // Print raw text if not JSON
        }

        if (!netcoreResponse.ok) {
            console.error("Netcore request failed!");
            // Potentially throw error here depending on required logic
        }

    } catch (error) {
        console.error(`ERROR sending request to Netcore: ${error.message}`);
    }
}

// --- Execute the main function ---
syncContact().catch(e => console.error("Unhandled error in syncContact:", e));

                </code></pre>
                 <p>
                    This Node.js example uses `node-fetch` to **conceptually** fetch Dynamics data (requires `npm install node-fetch`). **Authentication is omitted.** It simulates the response, maps fields, and then uses `URLSearchParams` to prepare the form-encoded payload for the Netcore request. Replace placeholders, implement authentication/error handling. Note HTML escaping (&amp;amp;). <br><strong>Security Note:</strong> Avoid exposing API keys in client-side browser JS.
                </p>
            </div>

            <div id="csharp-content" class="tab-pane">
                 <pre><code class="language-csharp">
using System;
using System.Collections.Generic;
using System.Net.Http;
using System.Net.Http.Headers; // For AuthenticationHeaderValue
using System.Text.Json;
using System.Threading.Tasks;

public class NetcoreApiClientWithDynamicsRead
{
    // --- Netcore Configuration ---
    private static readonly string NetcoreApiKey = "YOUR_NETCORE_API_KEY"; // <<< REPLACE
    private static readonly string NetcoreListId = "YOUR_NETCORE_LIST_ID"; // <<< REPLACE
    private static readonly string NetcoreApiUrl = "https://api.netcoresmartech.com/apiv2";

    // --- Dynamics 365 Configuration (Conceptual) ---
    private static readonly string DynamicsApiEndpoint = "https://yourorg.api.crm[X].dynamics.com/api/data/v9.2/"; // <<< REPLACE
    private static readonly string EntityPluralName = "contacts";
    private static readonly string RecordId = "YOUR_DYNAMICS_RECORD_ID_GUID"; // <<< REPLACE
    private static readonly string FieldsToSelect = "?$select=firstname,lastname,emailaddress1,mobilephone"; // <<< REPLACE/VERIFY

    // Use a static HttpClient instance
    private static readonly HttpClient httpClient = new HttpClient { Timeout = TimeSpan.FromSeconds(30) };

    public static async Task SyncContactStandalone()
    {
        Dictionary&lt;string, string&gt; contactDataForNetcore = null;

        // --- Conceptual Dynamics 365 Data Retrieval ---
        Console.WriteLine("--- Attempting Conceptual Dynamics Data Retrieval ---");
        try
        {
            string dynamicsFetchUrl = <span class="math-inline">"\{DynamicsApiEndpoint\}\{EntityPluralName\}\(\{RecordId\}\)\{FieldsToSelect\}";
Console\.WriteLine\(</span>"Conceptual Dynamics Fetch URL: {dynamicsFetchUrl}");

            // !!! CRITICAL: AUTHENTICATION IS MISSING HERE !!!
            // Real code requires obtaining an access token and adding it.
            var dynamicsRequest = new HttpRequestMessage(HttpMethod.Get, dynamicsFetchUrl);
            dynamicsRequest.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
            dynamicsRequest.Headers.Add("OData-MaxVersion", "4.0");
            dynamicsRequest.Headers.Add("OData-Version", "4.0");
            dynamicsRequest.Headers.Add("Prefer", "odata.include-annotations=\"*\"");
            // dynamicsRequest.Headers.Authorization = new AuthenticationHeaderValue("Bearer", "YOUR_ACCESS_TOKEN"); // <<< REQUIRED BUT OMITTED

            // --- SIMULATING API Call Success ---
            // In real code:
            // HttpResponseMessage dynamicsResponse = await httpClient.SendAsync(dynamicsRequest);
            // dynamicsResponse.EnsureSuccessStatusCode(); // Throw on HTTP error
            // string responseJson = await dynamicsResponse.Content.ReadAsStringAsync();
            // Console.WriteLine("--- Successfully fetched Dynamics Data (Simulated) ---");
            // Console.WriteLine($"Dynamics Response JSON: {responseJson}");
            // using JsonDocument document = JsonDocument.Parse(responseJson);
            // JsonElement root = document.RootElement;

            // Using simulated data:
            string simulatedResponseJson = <span class="math-inline">@"\{\{
""@odata\.context""\: ""\.\.\."",
""firstname""\: ""Mike \(Read\)"",
""lastname""\: ""CS\-Dynamics"",
""emailaddress1""\: ""mike\.read\.cs@example\.com"",
""mobilephone""\: ""5557778888"",
""contactid""\: ""\{RecordId\}""
\}\}";
Console\.WriteLine\(</span>"Simulated Dynamics Response: {simulatedResponseJson}");
             using JsonDocument document = JsonDocument.Parse(simulatedResponseJson);
             JsonElement root = document.RootElement;

             // --- Map Dynamics data to Netcore structure ---
            contactDataForNetcore = new Dictionary&lt;string, string&gt;();
            if (root.TryGetProperty("emailaddress1", out JsonElement emailEl) &amp;&amp; emailEl.ValueKind == JsonValueKind.String)
                contactDataForNetcore["EMAIL"] = emailEl.GetString();
            if (root.TryGetProperty("mobilephone", out JsonElement mobileEl) &amp;&amp; mobileEl.ValueKind == JsonValueKind.String)
                contactDataForNetcore["MOBILE"] = mobileEl.GetString();
            if (root.TryGetProperty("firstname", out JsonElement fnEl) &amp;&amp; fnEl.ValueKind == JsonValueKind.String)
                contactDataForNetcore["FIRST_NAME"] = fnEl.GetString();
            if (root.TryGetProperty("lastname", out JsonElement lnEl) &amp;&amp; lnEl.ValueKind == JsonValueKind.String)
                contactDataForNetcore["LAST_NAME"] = lnEl.GetString();
            // Map other fields...

            Console.WriteLine(<span class="math-inline">"\-\-\- Mapped data for Netcore\: \{JsonSerializer\.Serialize\(contactDataForNetcore\)\} \-\-\-"\);
\}
catch \(Exception ex\)
\{
Console\.Error\.WriteLine\(</span>"ERROR during conceptual Dynamics retrieval/mapping: {ex.Message}");
            // Handle error
        }
